{"version":3,"sources":["instagramScanner.es6"],"names":[],"mappings":"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","file":"instagramScanner.js","sourcesContent":["/**\r\n * Created by aikeru on 10/17/2015.\r\n */\r\n\r\nvar webdriverio = require('webdriverio');\r\n//TODO: This still doesn't quite work and the first multi-file download request must still be manually allowed\r\nvar options = { desiredCapabilities: {\r\n        browserName: 'chrome',\r\n        chromeOptions: {\r\n            prefs: {\r\n                'multiple-automatic-downloads': 1,\r\n                profile: {\r\n                  'default_content_settings': {\r\n                      download: { prompt_for_download: false },\r\n                      'multiple-automatic-downloads': 1\r\n                  }\r\n                },\r\n                'default_content_settings': {\r\n                    'multiple-automatic-downloads': 1,\r\n                    download: {\r\n                        prompt_for_download: false\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\nvar client = webdriverio.remote(options);\r\nvar fs = require('fs');\r\n\r\nvar config = require('./config.json');\r\n\r\nconsole.log('Await ready up!');\r\nasync function startScanner() {\r\n  try {\r\n     console.log('Await going ...');\r\n     await client.init().url('https://instagram.com');\r\n     await client.waitForVisible('[name=\"username\"');\r\n     await client.setValue('[name=\"username\"]', config.username);\r\n     await client.setValue('[name=\"password\"]', config.password);\r\n     await client.execute(() => {\r\n        jQuery('button:contains(Log in)')[0].click();\r\n     });\r\n      console.log('Clicked log in ...');\r\n      await waitForUrl('https://instagram.com/');\r\n      console.log('Made it to dashboard ...');\r\n      await client.waitForVisible('.-cx-PRIVATE-SearchBox__inactiveSearchQuery', 5000);\r\n      await client.click('.-cx-PRIVATE-SearchBox__inactiveSearchQuery');\r\n      await client.keys('#' + config.tag);\r\n      await sleepPromise(1000);\r\n      await waitForJavaScript(function() {\r\n         return jQuery('.-cx-PRIVATE-Search__resultTitleText').length > 0;\r\n      }, 2500);\r\n      await client.execute(function() {\r\n          jQuery('.-cx-PRIVATE-Search__resultTitleText')[0].click();\r\n      });\r\n        await waitForUrl('https://instagram.com/explore/tags/' + config.tag + '/', 5000);\r\n      console.log('Made it to ' + config.tag + '...');\r\n      await sleepPromise(500);\r\n      console.log('Found the first image');\r\n      scanAndDownloadImages(); //kick off the motherload!\r\n\r\n        //Scan again\r\n      //If we don't find any new images we should refresh\r\n\r\n     console.log('await done I guess ...');\r\n  }catch(e) {\r\n     console.log(e);\r\n  }\r\n}\r\n\r\nasync function doRefresh() {\r\n    console.log('We did not find new content. Wait, and then refresh.');\r\n    await sleepPromise(config.waitBetweenRefresh);\r\n    await client.refresh();\r\n    //Not sure if this is needed, but we want a new context I guess\r\n    setTimeout(function() {\r\n        console.log('Starting after refresh ...');\r\n        scanAndDownloadImages();\r\n    }, 1000);\r\n}\r\nasync function scanAndDownloadImages() {\r\n    var isImagesVisible = await client.execute(function() {\r\n        return jQuery('img.-cx-PRIVATE-Photo__image').length > 0;\r\n    });\r\n    if(!isImagesVisible.value) {\r\n        //no images visible for this tag ... yet?\r\n        console.log('Do not see images yet.');\r\n        doRefresh();\r\n        return;\r\n    }\r\n        await client.waitForVisible('img.-cx-PRIVATE-Photo__image');\r\n     var photoImgResult = await getPhotos();\r\n        var photoArr = photoImgResult.value;\r\n        console.log('Found', photoArr.length,'photos');\r\n      var downloadedFiles = await getDownloadedFiles(); //just returns filenames, ie: 'desktop.ini'\r\n      var downloadedImages = downloadedFiles.filter((df) => df.endsWith('jpg'));\r\n      console.log('Found', downloadedImages.length,'downloaded files already');\r\n      var missingFiles = photoArr.filter((p) => {\r\n          var imgName = p.substring(p.lastIndexOf('/') + 1);\r\n            return !downloadedImages.includes(imgName);\r\n      });\r\n      console.log('Seems', missingFiles.length, 'are not in our downloaded folder...');\r\n      if(missingFiles.length === 0) {\r\n          doRefresh();\r\n          return;\r\n      }\r\n      //Download the image files that we do not have\r\n      for(var i = 0; i < missingFiles.length; i++) {\r\n          console.log('Going to try and download', missingFiles[i])\r\n          await sleepPromise(2500); //Hopefully we don't look like we're spammy\r\n          await downloadPhoto(missingFiles[i]);\r\n          await sleepPromise(1000); //Hopefully the image downloads this fast ... ha\r\n          console.log('Okay, moving on to the next operation ...');\r\n      }\r\n\r\n      //Scroll to the bottom of the page\r\n      await scrollToBottom();\r\n      await sleepPromise(1500);\r\n\r\n      var photoImgResult2 = await getPhotos();\r\n      //Are any of the photos now new to us?\r\n      var foundNew = false;\r\n    for(var i = 0; i < photoImgResult2.value.length; i++) {\r\n        var photo2 = photoImgResult2.value[i];\r\n        if(!photoArr.includes(photo2)) {\r\n            //Grab 'em!\r\n            scanAndDownloadImages();\r\n        }\r\n    }\r\n    //No new photos ... load more button?\r\n      var isVisibleResult = await client.execute(function() {\r\n         return jQuery('a:contains(Load more)').length > 0;\r\n      });\r\n      if(!isVisibleResult.value) {\r\n          console.log('There is no load more button. Assuming there are no more images right now.');\r\n          doRefresh();\r\n          return;\r\n      }\r\n      await client.execute(function() {\r\n        jQuery('a:contains(Load more)')[0].click();\r\n      });\r\n      await sleepPromise(1500);\r\n     console.log('Clicked load more, scanning again!');\r\n     scanAndDownloadImages();\r\n}\r\n\r\nfunction scrollToBottom() {\r\n    return client.execute(function() {\r\n        jQuery('html, body').animate({scrollTop: jQuery(document).height()}, 'slow');\r\n    });\r\n}\r\n\r\nfunction sleepPromise(msec) {\r\n    var p = new Promise(function(resolve, reject) {\r\n        setTimeout(() => {\r\n            resolve();\r\n        }, msec);\r\n    });\r\n    return p;\r\n}\r\nfunction getDownloadedFiles() {\r\n    var p = new Promise(function(resolve, reject) {\r\n        fs.readdir(config.downloadFolder, (err, list) => {\r\n            if(err) { console.error(err); reject(); }\r\n            resolve(list);\r\n        });\r\n    });\r\n    return p;\r\n}\r\nfunction downloadPhoto(imgSrc) {\r\n    //Check if we've seen this file before\r\n\r\n    var funcStr = `\r\n        (function() {\r\n            var downloadLink = \"<DownloadLink>\";\r\n            var downloadTag = jQuery('<a href=\"' + downloadLink + '\" download>Down</a>');\r\n            downloadTag[0].click();\r\n        })\r\n    `;\r\n    funcStr = funcStr.replace('<DownloadLink>', imgSrc);\r\n\r\n    return client.execute(eval(funcStr));\r\n}\r\n\r\nfunction getPhotos() {\r\n    return client.execute(function() {\r\n       var images = [];\r\n        $.each(jQuery('.-cx-PRIVATE-Photo__placeholder img.-cx-PRIVATE-Photo__image'), function() {\r\n          images.push($(this).attr('src'));\r\n        });\r\n        return images;\r\n    });\r\n}\r\n\r\nfunction openFirstPhoto() {\r\n      return client.execute(function() {\r\n        jQuery('img.-cx-PRIVATE-Photo__image')[0].click();\r\n      });\r\n}\r\n\r\nstartScanner();\r\n\r\nfunction waitForJavaScript(jsFunc, msec) {\r\n   return client.waitUntil(function() {\r\n      return client.execute(jsFunc).then(function(result) { return result.value; });\r\n   }, msec || 1000);\r\n}\r\n\r\nfunction waitForDomReady() {\r\n   waitForJavaScript(function() {\r\n      if (document.readyState === 'complete') {\r\n         return true;\r\n      } else {\r\n         return false;\r\n      }\r\n   });\r\n}\r\n\r\nfunction closeModal() {\r\n   client.execute(function() {\r\n      var elements = document.getElementsByClassName('closeModal');\r\n      if(elements.length) {\r\n         elements[0].click();\r\n      }\r\n   });\r\n}\r\nfunction waitForUrl(urlStr, msec) {\r\n   return client.waitUntil(function() {\r\n      return client.url().then(function(resp) {\r\n          console.log('Checking if',resp.value,urlStr,'are equal');\r\n         return resp.value === urlStr;\r\n      });\r\n   }, msec || 1000);\r\n}\r\n"]}